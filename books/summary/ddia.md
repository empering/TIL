# 데이터 중심 애플리케이션 설계

> 마틴 클레프만 저 | 정재부 , 김영준 , 이도경 역 | 위키북스 | 2018.

​	

![book-cover](https://user-images.githubusercontent.com/13076271/88173485-9b6f2a00-cc5d-11ea-8284-72ffb0f33174.jpg)

[책 구매하기](https://coupa.ng/bGCnLK)

>  위 링크를 통해 제품 구매가 이루어진 경우 쿠팡 파트너스 활동 일환으로 인해 일정 수수료가 블로거에게 제공됨.



***<u>본 내용은 책 내용에 대한 개인적 이해를 바탕으로 한 요약과 생각이므로 정확한 내용은 반드시 책을 참고하길 권장함.</u>***




## 7장 트랜잭션

냉혹한 현실 세계 데이터 시스템은 여러 문제가 생길 수 있음.

- 데이터베이스 소프트웨어나 하드웨어는 언제라도 실패할 수 있음
- 애플리케이션은 언제라도 죽을 수 있음
- 네트워크는 언제라도 갑자기 끊길 수 있음
- 여러 클라이언트가 동시에 데이터베이스 쓰기를 해서 내용을 덮어쓸 수 있음
- 클라이언트가 부분적으로 갱신 된 비정상 데이터를 읽을 수 있음
- 클라이언트 사이 경쟁 조건은 예측 못한 버그를 유발할 수 있음



수십년간 이런 문제를 단순화 하기 위해 트랜잭션이라는 메키니즘이 채택 됨. 

- 트랜잭션은 애플리케이션에서 몇 개의 읽기와 쓰기를 하나의 논리적 단위로 묶는 방법
-  데이터베이스에 접속하는 애플리케이션에 프로그래밍 모델을 단순화하려는 목적으로 만들어짐
- 안정성 보장 (Safety Guarantee)



### 애매모호한 트랜잭션 개념

트랜잭션이 제공하는 안정성 보장은 ACID. 하지만 실제로 어떤 것을 기대할 수 있는지 분명하지 않으며 거의 마케팅 용어가 되어 버렸다고 함.

> ACID 표준을 따르지 않는 BASE 도 있음. Basically Available, Soft state, Eventual consistency. ACID 보다 더 모호함.



#### 원자성

- 다중 스레드 프로그래밍에서는 원자성은 한 스레드가 연산을 실행하면 다른 스레드는 절반만 완료된 연산을 관찰할 수 없음. 즉, 실행 전 or 실행 후만 있음.
- 반면 ACID 맥락에서 원자성은 동시성과 무관. 여러 스레드가 동시에 접근할 때 무슨 일이 생기는지는 격리성에서 다룸.
- 대신 클라이언트가 쓰기 작업 몇 개를 실행하다 일부만 처리 후 결함이 생기면 무슨 일이 생기는지를 설명함. 원자적인 트랜잭션에 결함이 생기면 트랜잭션내에서 실행 된 쓰기를 무시하거나 취소 해야 함.
- 따라서 저자는 ACID 에서 A 는 원자성(Atomicity)보다 어보트 능력(Abortability) 가 더 적합한 단어가 아니냐고 이야기 함.

#### 일관성

- 일관성 역시 복제, 해싱, CAP, ACID 각각의 맥락에서 여러가지 의미로 쓰임.
- 일관성의 아이디어는 항상 진실이어야 하는, 데이터에 관한 어떤 불변식이 있다는 것.
- 하지만 일관성은 데이터베이스가 보장할 수 있는 것이 아님. 애플리케이션의 불변식 개념에 의존하고, 일관성을 유지하도록 트랙잭션을 올바르게 정의하는 것도 애플리케이션이 책임짐.
- 외래키제약, 유일성제약 등 데이터베이스에서 할 수 있는 특정 종류의 불변식이 있긴 하지만 일반적으로 데이터베이스는 단지 데이터를 저장할 뿐임.

#### 격리성

- 여러 클라이언트에서 동일한 데이터베이스 레코드에 접근하면 동시성 문제가 생김.
- ACID 맥락에서 격리성은 동시에 실행 되는 트랜잭션이 서로 격리 된다는 것을 의미. 고전적인 데이터베이스 교과서에서는 격리성을 직렬성이라는 용어로 공식화 함.
- 즉, 직렬성은 각 트랜잭션이 전체 데이터베이스에서 실행되는 유일한 트랜잭션인 것처럼 동작함. (동시에 실행되더라도 하나씩 차례로)
- 하지만 직렬성(Serializable) 격리는 성능 손해를 동반함.

#### 지속성

- ACID 맥락에서 지속성은 트랜잭션이 성공적으로 커밋됐다면 하드웨어 결함, 데이터베이스의 문제가 생겨도 기록한 데이터는 손실되지 않는다는 보장임.
- 단일 노드 데이터베이스에서 지속성은 일반적으로 비휘발성 저장소에 기록됐다는 의미로, 복제 기능이 있는 데이터베이스에서는 성공적으로 다른 노드에 복사됐다는 것을 의미.
- 하지만 모든 비휘발성 저장소와 백업이 동시에 파괴된다면 데이터베이스가 할 수 있는건 아무것도 없음.
- 현실에서 절대적 보장을 제공하는 기법은 없음. 디스크에 쓰기, 복제하기, 백업 등을 포함해 위험을 줄이는 기법이 있을 뿐. 이들은 함께 쓸 수 있으며 그래야만 함.
- 항상 이론적인 ‘보장’은 약간 에누리해서 듣는게 현명하다고 함.
