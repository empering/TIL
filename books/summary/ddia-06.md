# 데이터 중심 애플리케이션 설계

> 마틴 클레프만 저 | 정재부 , 김영준 , 이도경 역 | 위키북스 | 2018.


![book-cover](https://user-images.githubusercontent.com/13076271/88173485-9b6f2a00-cc5d-11ea-8284-72ffb0f33174.jpg)

[책 구매하기](https://coupa.ng/bGCnLK)

>  위 링크를 통해 제품 구매가 이루어진 경우 쿠팡 파트너스 활동 일환으로 인해 일정 수수료가 블로거에게 제공됨.



***<u>본 내용은 책 내용에 대한 개인적 이해를 바탕으로 한 요약과 생각이므로 정확한 내용은 반드시 책을 참고하길 권장함.</u>***




# 6장. 파티셔닝

파티셔닝의 목적은 데이터와 질의 부하를 노드 사이에 고르게 분산시키는 것. 각 파티션은 그 자체로 작은 데이터베이스가 된다고 볼 수 있음.

하지만 파티셔닝이 고르게 이뤄지지 않아 데이터가 더 많거나 질의를 많이 받는 상황을 쏠렸다(skewed)고 하고, 불균형하게 부하가 높은 파티션을 핫스팟이라고 함.

이 장에서는 이를 극복하기 위한 방법들을 주로 설명

## 키-값 데이터 파티셔닝

- 핫스팟을 회피하는 가장 단순한 방법은 레코드를 할당할 노드를 무작위 선택하는 것
- 데이터가 노드들 사이에 매우 고르게 분산되는 반면, 특정 레코드를 읽을때 어느 노드에 있는지 알 수 없음. 따라서 모든 노드에 병렬 질의 해야 함.
- 키-값 데이터 모델에서는 항상 기본키를 통해 접근함으로써 이를 해결 가능

### 키 범위 기준 파티셔닝

- 종이 백과사전처럼 각 파티션에 연속된 범위의 키를 할당하는 것. 예컨대 노드1에는 A~B 까지.
- 각 범위들 사이의 경계를 알면 어떤 키가 어느 파티션에 속하는지 쉽게 찾음.
- 키 범위 크기는 반드시 동일할 필요 X. 데이터가 고르게 분포하지 않을 수 있기 때문.
- 이 방법의 문제는 특정한 접근 패턴이 핫스팟을 유발한다는 것. 예를 들어 타임스탬프가 키이고 이를 기준으로 파티셔닝한다면 오늘 발생하는 쓰기는 모든 같은 파티션으로 쏠림.

### 키의 해시값 기준 파티셔닝

- 쏠림과 핫스팟의 위험으로 많은 분산 데이터 스토어는 키의 파티션을 정하는데 해시 함수를 사용
- 반면 해시값을 사용하면 키 범위 파티셔닝의 좋은 속성을 잃게 됨. 바로 범위 질의를 효과적으로 실행할 수 있는 능력.
- 키 범위 기준 파티셔닝은 인접 키들이 같은 파티션에 속하지만 해시값으로 파티셔닝시 모든 파티션에 흩어져 정렬 순서가 유지되지 않고 모든 파티션에 질의가 전송되어야 함.

### 쏠린 작업부하와 핫스팟 완화

- 해시값 기준 파티셔닝으로도 핫스팍을 완벽히 제거할 수는 없음. 항상 동일한 키를 읽고 쓰는 극단적인 상황에서는 모든 요청이 동일 파티션에 쏠림.
- 예컨대 소셜 미디어 사이트에서 수백만 팔로워를 거느린 유명인이 실행한 어떤 작업으로 동일한 키에 막대한 데이터를 기록해야 한다거나
- 현대 데이터 시스템은 대부분 크게 쏠린 작업부하를 자등으로 보정하지 못하므로 애플리케이션에서 쏠림을 완화해야 함.
- 가장 간단한 방법은 요청이 매우 쏠리는 키를 발견했을 때 작업키 시작이나 끝에 임의의 숫자를 붙이는 것. 임의의 10진수 두개만 붙여도 한 키에 대한 쓰기 작업이 100개의 다른 키로 균등하게 분산.
- 트레이드 오프는 해당 임의의 숫자를 어딘가에 기억해야 한다는 것이고, 해시값 기준 파티셔닝의 단점과 같이 읽기시 추가적인 작업이 필요하다는 것.
